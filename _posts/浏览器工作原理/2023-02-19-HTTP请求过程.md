---
layout:     post
title:      HTTP请求过程
subtitle:  
date:       2023-02-19
author:     
header-img: 
catalog: true
tags:
  - 浏览器工作原理
typora-root-url: ..



---

# HTTP请求处理过程

### 浏览器端发起 HTTP 请求流程

1. **构建请求**

    浏览器构建请求行，构建好后，准备发起网络请求

    ```
    GET /index.html HTTP1.1
    ```

2. **查找缓存**

    在真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件。当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。

3. **准备IP和端口号**

    通过DNS查找域名对应的IP地址，而端口号，没有指明的情况下，HTTP的端口号默认是80。

4. **等待TCP队列**

    Chome浏览器同一个域名最多只能简历6个TCP连接，如果请求连接数大于6，剩下的请求会进入等待队列。

    > http/1.1 一个tcp同时只能处理一个请求，浏览器会为每个域名维护6个tcp连接！ 但是每个tcp连接是可以复用的，也就是处理完一个请求之后，不断开这个tcp连接，可以用来处理下个http请求！
    >
    > http2可以并行请求资源，浏览器只会为每个域名维护一个tcp连接

5. **建立TCP连接**

    三次握手，浏览器与服务器建立TCP连接

6. **发送HTTP请求**

    首先发送请求行：如上1，包括了请求方法，请求URI和HTTP版本。

    再发送请求头，把浏览器的一些基础信息告诉服务器，比如包含了浏览器所使用的操作系统、浏览器内核等信息，以及当前请求的域名信息、浏览器端的 Cookie 信息，等等。

    <img src="/../img/postImage/image-20230219150858180.png" alt="image-20230219150858180" style="zoom:50%;" />

    

### 服务器端处理 HTTP 请求流程

服务器处理完毕之后，便开始返回数据给浏览器。可以通过下面的命令查看服务器返回的数据。

```
curl -i  https://time.geekbang.org/
```

1. **返回数据**

    首先服务器会返回响应行，包括协议版本和状态码。

    不是所有的请求数据都可以被返回，服务器会通过状态码来告知请求状态。比如说返回状态码404用来告知请求的页面没有找到。

    服务器也会随同响应向浏览器发送响应头。响应头包含了服务器自身的一些信息，比如服务器生成返回数据的时间、返回的数据类型（JSON、HTML、流媒体等类型），以及服务器要在客户端保存的 Cookie 等信息。

2. **断开连接**

    通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接。除非浏览器或者服务器在其头信息中加入了

    ```
    connection: keep-alive
    ```

3. **重定向**

    当响应行返回的状态码是 301时，告诉浏览器需要重定向到另外一个网址，而需要重定向的网址正是包含在响应头的 Location 字段。接下来，浏览器获取 Location 字段中的地址，并使用该地址重新导航。

### 总结

![image-20230219151855422](/../img/postImage/image-20230219151855422.png)

### Q & A

**Q**：如果一个页面的网络加载时间过久，你是如何分析卡在哪个阶段的？

**A**：1 首先猜测最可能的出问题的地方，网络传输丢包比较严重，需要不断重传。然后通过ping curl看看对应的时延高不高。

​	   2 然后通过wireshake看看具体哪里出了问题。

​       3 假如别人访问很快，自己电脑很慢，就要看看自己客户端是否有问题了。