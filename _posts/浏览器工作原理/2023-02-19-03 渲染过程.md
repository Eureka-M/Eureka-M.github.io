---
layout:     post
title:      渲染过程
subtitle:  
date:       2023-02-19
author:     
header-img: 
catalog: true
tags:
  - 浏览器工作原理
typora-root-url: ..
---

# 浏览器渲染过程

<img src="/../img/postImage/image-20230219174032547.png" alt="image-20230219174032547" style="zoom:67%;" />

1. 构建dom树

    构建 DOM 树的输入内容是HTML 文件，然后经由 HTML 解析器解析，最终输出树状结构的 DOM。

2. 计算每个节点的css样式

    - 渲染引擎将 CSS 文本转换为浏览器可以理解的结构——styleSheets。

    - 转换样式表中的属性值，使其标准化
    - 计算出 DOM 树中每个节点的具体样式

3. 构建布局树（不可见的节点不会包含在内）

4. 对布局树进行分层，并生成分层树

    - 特定节点生成专用图层，生成一棵图层树
    - 拥有层叠上下文属性（明确定位属性、透明属性、CSS 滤镜、z-index 等）的元素会创建单独图层
    - 没有图层的 DOM 节点属于父节点图层
    -  需要剪裁的地方也会创建图层

5. 为每个图层生成绘制列表，并将其提交到合成线程。

    - 渲染引擎对图层树中每个图层进行绘制
    -  拆分成绘制指令，生成绘制列表，提交到合成线程

6. 合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。

    - 光栅化：将计算后的信息（比如文档结构、元素样式、绘制顺序）转换为屏幕上的像素

    - 合成线程会将较大、较长的图层（一屏显示不完，大部分不在视口内）划分为图块
    -  在光栅化线程池中，将视口附近的图块优先生成位图（栅格化执行该操作）

7. 合成线程发送绘制图块命令 DrawQuad 给浏览器进程。

8. 浏览器进程根据 DrawQuad 消息生成页面，并显示到显示器上。