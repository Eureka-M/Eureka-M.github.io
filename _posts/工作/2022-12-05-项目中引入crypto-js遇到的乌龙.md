---
layout:     post
title:      å¼•å…¥ç¬¬ä¸‰æ–¹åº“é‡åˆ°çš„ä¹Œé¾™
subtitle:  
date:       2022-12-05
author:     
header-img: 
catalog: true
tags:
  - å·¥ä½œ
typora-root-url: ..

---

# å¼•å…¥ç¬¬ä¸‰æ–¹åº“é‡åˆ°çš„ä¹Œé¾™

ä»¥ä¸‹æ˜¯åŸæ–‡ï¼š

é¡¹ç›®æœ¬åœ°å¹¶æ²¡æœ‰ä½¿ç”¨æ‰“åŒ…çš„åŠŸèƒ½ï¼Œä½¿ç”¨eslå¼•å…¥ä¸€äº›ç¬¬ä¸‰æ–¹åº“ã€‚åŸæ¥çš„ç¬¬ä¸‰æ–¹åº“éƒ½æ˜¯æ”¾åœ¨/dep/æ–‡ä»¶å¤¹ä¸‹ã€‚

æœ¬åœ°å¼•å…¥çš„æ—¶å€™åªéœ€è¦æŒ‰ç…§è·¯å¾„å¼•å…¥æ—¢å¯ã€‚

```
require.config({
		baseUrl: "{{ $static_origin }}/src"
    packages: [
    	{
        name: 'moment',
        location: '../dep/moment/2.10.6/src',
        main: 'moment'
    	},
    	{
        name: 'cropper',
        location: '../dep/cropper/3.1.3/src',
        main: 'cropper'
    	},
    	{
    		name: 'cryptoJs',
        location: '../../node_modules/crypto-js',
        main: 'crypto-js'
    	}
    ]
})
```

```
var cryptojs = require('cryptoJs')
```

è™½ç„¶çœ‹èµ·æ¥å¾ˆæ€ªå¯¹ä¸å¯¹ï¼Œå“ªæœ‰ä»£ç è¿™ä¹ˆå†™çš„ï¼Œå¼•ç”¨è·¯å¾„æ˜¯node_modulesã€‚ã€‚ã€‚

æ¨ä¸Šæµ‹è¯•ç¯å¢ƒï¼ŒæŠ¥é”™äº†ï¼Œæ‰¾ä¸åˆ°è¯¥æ¨¡å—ï¼Œäºæ˜¯æƒ³ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

æµ‹è¯•ç¯å¢ƒä½¿ç”¨çš„æ˜¯webpackæ‰“åŒ…ï¼Œä½†æ˜¯æœ¬åœ°ä¸ç”¨ï¼Œæ‰€ä»¥åˆ¤æ–­ä¸€ä¸‹ï¼Œæ”¹æˆäº†è¿™æ ·ã€‚

```
var packages = [
	{
     name: 'moment',
     location: '../dep/moment/2.10.6/src',
     main: 'moment'
  },
  {
      name: 'cropper',
      location: '../dep/cropper/3.1.3/src',
      main: 'cropper'
   }
]

if (//æ˜¯æœ¬åœ°) {
		packages.push({
        name: 'cryptoJs',
        location: '../../node_modules/crypto-js',
        main: 'crypto-js'
    })
}
require.config({
		baseUrl: "{{ $static_origin }}/src"
    packages: packages
})

```

éƒ¨ç½²testä¹‹åï¼Œå‘ç°è¿˜æ˜¯æŠ¥é”™å•Šï¼Œæ‰¾å•Šæ‰¾äºæ˜¯ä¹ï¼Œå‘ç°æµ‹è¯•ç¯å¢ƒå¼•ç”¨çš„æ—¶å€™æ€ä¹ˆå¯ä»¥æ˜¯å¼•ç”¨æœ¬åœ°require.configé‡Œå®šä¹‰çš„åˆ«åå‘¢ï¼Ÿ

```
packages.push({
    name: 'crypto-js',
    location: '../../node_modules/crypto-js',
    main: 'crypto-js'
})
```

```
var cryptojs = require('crypto-js')
```

å†éƒ¨ç½²ï¼Œå‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªè¯·æ±‚æŠ¥404äº†ï¼Œbetaç¯å¢ƒçš„æ­£ç¡®è·¯å¾„æ˜¯/m/assets/classroom_....

<img src="/../img/postImage//20230212204745.png" alt="image-20230212204744" style="zoom: 25%;" />

é—®äº†å¤§ä½¬ï¼Œè¯´æ˜¯æœ‰ä¸€ä¸ªåœ°æ–¹webpackæ‰“åŒ…çš„æ—¶å€™ä¼šå°†/src æ›¿æ¢æˆ/assetsã€‚å°±æ˜¯è¯´ï¼Œrequire.configé‚£æ®µä»£ç çš„baseURLå­—ç¬¦ä¸²æ²¡æœ‰æˆåŠŸæ›¿æ¢ï¼Œè™½ç„¶çœ‹ä¸å‡ºæ¥ä¸ºä»€ä¹ˆä¸Šé¢é‚£æ®µä»£ç ä¼šæœ‰é—®é¢˜ã€‚çè¯•äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå‘ç°ï¼Œè¿™æ ·å±…ç„¶æˆåŠŸäº†ï¼ï¼ï¼æˆ‘æŠŠrequire.configæ‹†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ã€‚

```
require.config({
	baseUrl: "{{ $static_origin }}/src"
})
var packages = [
	{
     name: 'moment',
     location: '../dep/moment/2.10.6/src',
     main: 'moment'
  },
  {
      name: 'cropper',
      location: '../dep/cropper/3.1.3/src',
      main: 'cropper'
   }
]

if (//æ˜¯æœ¬åœ°) {
		packages.push({
        name: 'crypto-js',
        location: '../../node_modules/crypto-js',
        main: 'index'
    })
}
require.config({
    packages: packages
})
```

è¿™æ˜¯ç¥é©¬æ“ä½œå•Šï¼Œè¿™æ ·ç«Ÿç„¶å¯ä»¥ã€‚é‚£æ—¢ç„¶å¯ä»¥ï¼Œå°±çœ‹çœ‹ä¸ºä»€ä¹ˆå¯ä»¥å§ã€‚

package.json

![image/20230212204338](/../img/postImage//20230212204338.png)

webpack.config.js

å¿˜è®°è¯´äº†ï¼Œrequire.configçš„ä»£ç æ‰§è¡Œæ˜¯åœ¨htmlé‡Œé¢æ‰§è¡Œçš„ï¼Œæ‰“åŒ…è¿‡ç¨‹ä¸­æœ‰å­—ç¬¦ä¸²çš„æ›¿æ¢ï¼Œé‚£åº”è¯¥å¤§æ¦‚ç‡æ˜¯åœ¨htmlè§£æå™¨é‡Œé¢è¿›è¡Œçš„ã€‚

![](/../img/postImage//20230212205236.png)

![image-20221205190537403](/../img/postImage//20230212205347.png)

é¡ºç€å»Html.jsé‡Œé¢æ‰¾

![](/../img/postImage//20230212205449%20(1).png)

è¿™ä¸ªå‡½æ•°å°†æ–‡ä»¶å†…å®¹ä¼ å…¥ï¼Œè¿›è¡Œè§£æã€‚æ‰¾åˆ°æˆ‘ä»¬å¯¹åº”çš„scipt.htmlæ–‡ä»¶ï¼Œçœ‹ä»–åšäº†ä»€ä¹ˆï¼Ÿ

![](/../img/postImage//20230212210117.png)

å†çœ‹è¿™ä¸ªè¯­å¥ï¼ŒreadRequireConfigè¡¨ç¤ºå®ƒæ˜¯ä»æ–‡ä»¶å†…å®¹é‡Œè¯»å‡ºå«æœ‰requireConfigçš„å†…å®¹

<img src="/../img/postImage//20230212212005.png" style="zoom:50%;" />

readRequireConfig(content)è¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å±æ€§æ˜¯dataï¼Œé‡Œé¢åˆšå¥½æ˜¯baseUrlï¼å…ˆä¸ç®¡ï¼Œæ¥ç€è¯»ä»£ç 

<img src="/../img/postImage//20230212212229.png" alt="image-20221206134952318" style="zoom: 33%;" />

å¯ä»¥å‘ç°ï¼Œå¯¹è¿™ä¸ªdataåˆ¤æ–­äº†ä¸€ä¸‹ã€‚æœ‰å€¼å°±ä¼šåšä¸€ä¸ªæ“ä½œï¼è¿™ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

<img src="/../img/postImage//20230212212318.png" alt="image-20221206135126956" style="zoom: 33%;" />

<img src="/../img/postImage//20230212212404.png" alt="image-20221206135305546" style="zoom:33%;" />

å¯ä»¥çœ‹åˆ°ï¼Œæ­£æ˜¯åšäº†æ›¿æ¢å­—ç¬¦ä¸²çš„æ“ä½œã€‚

å¥½äº†ï¼Œå¤§æ¦‚è¿™é‡Œå·²ç»æ¸…æ¥šäº†ï¼Œå¯ä»¥æ‹ä¸€ä¸‹ï¼Œè¯»åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç»è¿‡readRequireConfigå¤„ç†ä¸€ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œå…ƒç´ æœ‰ä¸€ä¸ªå±æ€§æ˜¯dataï¼Œå¦‚æœdataæœ‰å€¼ï¼Œå°±ä¼šè¿›å…¥getOutputAmdConfigè¿™ä¸ªå‡½æ•°é‡Œè¿›è¡Œï¼ŒæŠŠdataé‡Œçš„baseUrlçš„'src'æ›¿æ¢æˆ'assets'ã€‚

é‚£ä¹ˆï¼ŒreadRequireConfigè¿™ä¸ªå‡½æ•°å°±å€¼å¾—æ³¨æ„äº†ï¼Œæ˜¯å®ƒäº§ç”Ÿçš„dataã€‚

```
function readRequireConfig(content, fromIndex) {
	content = content.substr(fromIndex);
	var index = content.search(/(require\.config\(\s*\{)/);
	...
	var result = {
        content: content,
        fromIndex: index,
        indentBase: whitespace
  };
  ...
	content = content.slice(result.fromIndex, index);
	try {
        result.data = eval( '(' + content + ')' );
  }
  catch(e) {
        result.data = null;
  }
  ...
}
```

æ‘˜æŠ„äº†å…³é”®ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™æ®µä»£ç çš„å¤§æ¦‚å°±æ˜¯æŠŠæ–‡ä»¶å†…å®¹contentä¸­å«æœ‰require.configè¿™æ®µå†…å®¹æˆªå–å‡ºæ¥ï¼Œevalæ‰§è¡Œã€‚è¿™ä¹Ÿå°±èƒ½è§£é‡Šï¼Œä¸ºä»€ä¹ˆå½“åˆè¿™æ ·ç”¨æ˜¯æœ‰é—®é¢˜çš„ã€‚

```
require.config({
		baseUrl: "{{ $static_origin }}/src"
    packages: packages
})
```

evalæ‰§è¡Œä¸Šé¢è¿™ä¸ªå­—ç¬¦ä¸²å°±ä¼šæŠ¥é”™ï¼Œæ‰¾ä¸åˆ°è¿™ä¸ªpackagesï¼Œå°±ä¼šèµ°åˆ°catché‡Œï¼Œdataå°±ä¼šèµ‹å€¼ä¸ºnullï¼Œæœ€åè¿™å—ä»£ç ä¹Ÿä¸ä¼šèµ°è¿›getOutputAmdConfigé‡Œæ›¿æ¢æ‰å­—ç¬¦ä¸²ã€‚

å—¯ï¼Œä¸€åˆ‡éƒ½å¯ä»¥è§£é‡Šæ¸…æ¥šäº†ï¼ŒOKï¼Œå®Œç»“ï¼Œæ’’èŠ±ğŸ‰ã€‚



â€œå¤©çœŸçš„æˆ‘â€ã€‚ã€‚ã€‚ä¸‹é¢æ˜¯ä¹Œé¾™çš„ç–‘é—®ï¼š

è¯è¯´ï¼Ÿï¼Ÿæµ‹è¯•ç¯å¢ƒç”¨çš„webpackæ‰“åŒ…ï¼Œå®ƒä¼šè‡ªå·±å»node_modulesé‡Œé¢æ‰¾å¯¹åº”çš„æ¨¡å—ï¼Œrequire.configé‡Œé¢å®šä¹‰çš„æ¨¡å—ï¼Œæµ‹è¯•ç¯å¢ƒä¹Ÿæœ‰node_moduleså•Šï¼Ÿ

å»æ‰ifåˆ¤æ–­ï¼Œéƒ¨ç½²testï¼Œå®Œå…¨æ²¡é—®é¢˜ğŸ˜¢

å¥½äº†ï¼Œå¤§å¤§å¤§ä¹Œé¾™ï¼ï¼

