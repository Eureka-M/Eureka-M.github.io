---
layout:     post
title:     	HTTP2.0
subtitle:  
date:       2023-07-09
author:     
header-img: 
catalog: true
tags:
  - HTTP 相关内容
typora-root-url: ..
---

### 概述

2015 年 HTTP2.0 问世，HTTP2.0 是 SDPY 的一个升级版，但是也有很多不一样的地方。

![image-20230709163401839](/../img/postImage/image-20230709163401839.png)

### HTTP2.0 性能增强的核心

#### 二进制分帧

![image-20230709221717312](/../img/postImage/image-20230709221717312.png)

在二进制分帧层，HTTP 会把所有的传输信息分割成更小的消息和帧，并且采用二进制格式的编码。

HTTP1.1 中的首部消息在 HTTP2.0 中会被封装到 HEADERS frame 中，而传输的 Request body 会被封装到 DATA  frame中。

HTTP2.0 通信都在一个连接中完成，这个连接可以承载任意数量的双向数据流，相应得，每个数据流都以消息的形式发送，而且消息由一个或者多个帧组成，这些帧可以**乱序发送**，然后根据每个帧的首部标识符组装。

#### 首部压缩

![image-20230709222620200](/../img/postImage/image-20230709222620200.png)

HTTP2.0 在服务端和客户端中使用首部表（双方都会维护这个表），来跟踪和存储之前发送的键值对，对于相同的数据，不再通过每次请求 / 响应发送。通信期间几乎不会改变通用键值对，比如说可以接受不了的媒体类型等字段。

如果这个请求不包含首部，那么将继续使用之前的请求首部，不会重新发送。

如上图，Request #1 和 Request #2 中差别仅仅是 path，那么在 HTTP2.0 中，则只会发送这个变化的字段。

#### 多路复用

继承自 SPDY 协议，HTTP2.0 所有通信都在一个 TCP 连接上完成，HTTP2.0 的通信单位为帧，这些帧对应着逻辑流之间的信息，并且在一个 TCP 上双向交换信息。

![image-20230709223623690](/../img/postImage/image-20230709223623690.png)

##### 这种单连接多资源的优势

- 可以减少服务连接压力，内存占用减少，连接吞吐量增大
- 由于 TCP 连接减少而使网络用塞状况得以改观
- 慢启动时间减少，拥塞和丢包恢复速度更快

> 如果使用 HTTP2.0，那么减少网络请求（雪碧图，文件合并）就没有什么意义了。

#### 乱序发送（并行双向字节流的请求和响应）

![image-20230709224207506](/../img/postImage/image-20230709224207506.png)

在 HTTP2.0 中，客户端和服务器可以把消息分解成互不依赖的帧，然后乱序发送，然后在接收端把它们重新组合起来。

但是由于可以是双向的，所以客户端可以一边乱序地发送流，也可以一边接收服务器的响应。

##### 优势

- 并行交错地发送请求 / 响应，请求 / 响应之间互不影响。
- 只使用一个连接即可并行发送多个请求和响应。
- 消除不必要的延迟，减少页面加载的时间。

#### 请求优先级

- 高优先级的流应该优先发送
- 优先级不是绝对的，否则可能会引发首部阻塞等问题，一个请求一直被等待
- 不同优先级混合也是必须的

> 所以，Http2.0 不必担心明明在等待关键的 js，而服务器还在发送一个不重要的图片的情况。

#### 服务器推送

![image-20230709225052210](/../img/postImage/image-20230709225052210.png)

服务器可以对一个请求发送多个响应，换句话说，除了对最初请求资源的响应，服务端还可以额外向客户端推送资源，而不需要客户端明确的请求。