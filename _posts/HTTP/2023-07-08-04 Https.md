---
layout:     post
title:     	Https
subtitle:  
date:       2023-07-08
author:     
header-img: 
catalog: true
tags:
  - HTTP 相关内容
typora-root-url: ..
---

### 加密

#### 对称加密

加密和解密都是使用相同的密钥。请求方和响应方约定一个密钥，请求方使用该密钥进行加密，响应式使用该密钥进行解密。

但是这种并不是安全的，虽然在后续的交流已经对明文做了加密，如果在第一个通信已经被拦截了，那么密钥就会泄漏给中间人。中间人仍然可以解密后续的通信密文。

#### 非对称加密

加密和解密都是使用不同的密钥。非对称加密包含一个公钥和私钥。明文既可以用公钥加密，私钥解密。也可以用私钥加密，公钥解密。

过程如下：

 KEY1（公钥）KEY2 （私钥）

1. A 发送 KEY1（公钥）给 B

2. B 用 KEY1（公钥）加密 KEY2 ，加密结果为 VAL3，发送给 A
3. A 通过私钥解密，获得 KEY2
4. 接下来就可以使用 KEY2 进行加密聊天

这种方式，就算中间人第一次就截获了  KEY1（公钥）。但是由于不知道私钥是什么，没有办法解密。

**但是！！！中间人虽然不知道私钥是什么，但是它可以拦截请求之后，将 A 发送的公钥改掉，而 B 并不知道公钥的真实性**。

被攻击后，流程变为：

1. A 发送 KEY1（公钥）给 B。被 C 截获，将 KEY1（公钥）换成 KEY3（公钥）

2. B 用 KEY3 将 KEY2（公钥）加密，加密结果为 VAL4，发出
3. C 通过私钥解密，获得 KEY2，再用 KEY1 加密 KEY2 获得 VAL5
4. C 发送 VAL5 发送给 A。

#### 证书机构 CA

证书机构包含 证书颁发机构，服务端网址，机构私钥加密（服务端公钥），机构私钥加密（证书签名）。

流程：

1. 服务端把公钥 KEY1 发给证书机构，由证书机构去申请证书。证书机构自己也有一对公钥和私钥。机构用自己的私钥加密 KEY1，并且通过服务端网址生成一个证书签名。证书签名同样也经过证书机构的私钥加密，这样就完成了一份证书，之后机构把这个证书发送给服务端。
2. 后续客户端请求的话，服务端不会发送自己的公钥了，而是把证书发送给客户端。
3. 客户端收到证书之后，需要验证证书。**各大浏览器和操作系统已经维护了所有权威机构的名称和公钥，客户端只需要知道是哪个机构颁发的证书，就可以从本地找到对应的机构公钥解密出证书的签名**。接下来，客户端就可以用同样的签名规则，自己也生成一个证书签名。如果两个签名是一致的，则证书是有效的。
4. 之后，就可以利用机构的公钥解出服务端的公钥 KEY1 了。再用 KEY1 加密 KEY2 ，加密结果为 VAL。
5. 服务端通过私钥解密，获得 KEY2，接下来还是和以前一样用 KEY2 加密通信。

### HTTPS

HTTPS 可以认为是 `HTTP + TLS`。

TLS 是**传输层加密协议**，它的前身是 SSL 协议。

<img src="/../img/postImage/image-20230708183653983.png" alt="image-20230708183653983" style="zoom:50%;" />

#### 功能

- 内容加密
- 身份认证
- 数据完整性 

#### 使用成本

- 证书费用以及更新维护
- HTTPS 降低用户访问速度
- 消耗 CPU 资源，需要增大机器（非对称加密，对称加解密）

#### 对服务器性能的影响

- 协议交互所增加的网络 RTT（往返时延：从发送端发送数据开始，到发送端收到来自接收端的确认，这个过程一共消耗的时间）
- 加解密相关的计算耗时 
- 浏览器计算耗时
- 服务端计算耗时